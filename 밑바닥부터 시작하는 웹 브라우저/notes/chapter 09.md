# Chapter 9 대화형 스크립트 실행하기

## 실습

- 자바스크립트 파일 로드
  - Tab 클래스의 load 메서드에서 `<script>` 태그의 src 속성값을 자바스크립트 파일의 URL로 파싱하고 해당 URL로 요청을 보내 자바스크립트 파일 내용을 읽어온다.
    - `<script>` 태그의 시작 태그와 끝 태그 사이에 자바스크립트 코드를 직접 넣을 수도 있지만, 실습 브라우저는 해당 기능을 지원하지 않는다. 자바스크립트 코드에 포함된 작다('<')와 크다('>') 기호 때문에 파싱하기 어렵다.
  - 읽어온 자바스크립트 코드는 스타일과 레이아웃 처리 전에 수행한다.
    - 실제 브라우저는 기본적으로 전체 페이지가 파싱된 후가 아니라 `<script>` 태그를 파싱하자마자 자바스크립트를 실행한다. 실습 브라우저는 스크립트 태그에 defer가 있는 경우와 비슷하다. 기본 정책을 효율적으로 구현하는 것은 훨씬 더 까다롭다.
- 파이썬의 print 함수와 자바스크립트의 console.log 함수 바인딩
  - 파이썬에서 자바스크립트로 함수를 익스포트해야 한다. 실습 과정에서 많은 함수를 익스포트하므로 해당 책임을 관리하기 위한 JSContext 클래스를 추가한다.
  - JSContext 클래스는 DukPy의 JSInterpreter 객체를 소유하고, 자바스크립트 코드를 실행하는 run 메서드를 제공한다. JSInterpreter 객체는 모든 자바스크립트 변수의 값을 저장하고, 여러 자바스크립트 스니펫을 실행하고 변수의 값과 그 밖의 상태를 공유할 수 있다.
  - Tab 객체의 load 메서드는 페이지 로드시 JSContext를 초기화하고 현재 로드하는 페이지의 모든 스크립트를 실행한다.
    - 모든 스크립트에서 하나의 JSContext를 사용하는 부수 효과로 두 개 이상의 스크립트를 실행할 때 먼저 실행된 스크립트에서 선언한 변수를 이후 실행하는 스크립트에서도 사용 가능하다.
  - JSInterpreter 객체의 `export_function` 메서드를 사용해서 파이썬의 함수를 해당 자바스크립트 런타임으로 익스포트할 수 있다. JSInterpreter로 실행되는 자바스크립트 런타임에서는 `call_python` 메서드를 사용해서 파이썬에서 익스포트한 함수를 호출할 수 있다. 이 점을 응용하여 call_python 메서드로 "log" 이름으로 익스포트한 `print` 함수가 정의된 console 객체의 정의를 자바스크립트 런타임에 전달하면, 이후 자바스크립트 실행에서 console.log 함수 호출시 파이썬의 print 함수가 호출된다.

