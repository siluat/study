# 05 웹 어댑터 구현하기

## 의존성 역전

- 웹 어댑터는 외부로부터 요청을 받아 애플리케이션 코어를 호출하고 무슨 일을 해야 할지 알려준다. 이때 제어 흐름은 웹 어댑터에 있는 컨트롤러에서 애플리케이션 계층에 있는 서비스로 흐른다.
- 애플리케이션 계층은 웹 어댑터가 통신할 수 있는 특정 포트를 제공한다. 서비스는 이 포트를 구현하고 웹 어댑터는 이 포트를 호출할 수 있다. 의존성 역전 원칙이 적용되어 있다.

## 웹 어댑터의 책임

1. HTTP 요청을 자바 객체로 매핑
2. 권한 검사
3. 입력 유효성 검증
4. 입력을 유스케이스 입력 모델로 매핑
5. 유스케이스 호출
6. 유스케이스의 출력을 HTTP로 매핑
7. HTTP 응답을 반환

- 유스케이스 입력 모델에서 했던 유효성 검증을 똑같이 웹 어댑터에서도 구현해야 하는 것은 아니다. **웹 어댑터의 입력 모델을 유스케이스의 입력 모델로 변환할 수 있다**는 것을 검증해야 한다. 이 변환을 방해하는 모든 것이 유효성 검증 에러다.
- 웹 어댑터의 책임이 많지만, HTTP와 관련된 것은 애플리케이션 계층에 침투해서는 안 된다. 또 다른 인커밍 어댑터의 요청에 대해 동일한 도메인 로직을 수행할 수 있는 선택지를 잃게 된다.
- 특정 인커밍 어댑터를 생각할 필요 없이 유스케이스를 먼저 구현하면 경계를 흐리게 만들 유혹에 빠지지 않을 수 있다.

## 컨트롤러 나누기

- 컨트롤러를 몇 개 만들어야 할까? 너무 적은 것보다는 너무 많은 게 낫다.
- 각 컨트롤러가 가능한 한 좁고 다른 컨트롤러와 가능한 한 적게 공유하는 웹 어댑터 조각을 구현해야 한다.
- 모든 연산을 단일 컨트롤러에 넣는 것은 데이터 구조의 재활용을 촉진하는 문제가 있다.

## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

- 웹 컨트롤러를 나눌 때 모델을 공유하지 않는 여러 작은 클래스들을 만드는 것을 두려워해서는 안된다. 작은 클래스들이 더 파악하기 쉽고, 더 테스트하기 쉬우며, 동시 작업을 지원한다. 세분화된 컨트롤러를 만드는 것은 처음에는 조금 더 공수가 들겠지만 유지보수하는 동안에는 분명히 빛을 발할 것이다.
